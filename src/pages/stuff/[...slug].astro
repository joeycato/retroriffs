---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: '2-digit',
  });
}

function kebabCase(str: string): string {
  return str
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '-')
    .replace(/(^-|-$)/g, '');
}
---

<BaseLayout title={post.data.title} description={post.data.excerpt}>
  <div id="main-content" class="clearfix post-content-box">
    <article class="article-page">
      <div class="page-content">
        <div class="wrap-content">
          <header class="header-page">
            <h1 class="page-title">{post.data.title}</h1>
            <div class="page-date">
              <span>{formatDate(post.data.date)}</span>
            </div>
          </header>
          <div class="post-body">
            <Content />
          </div>
          <div class="page-footer">
            <div class="page-tag">
              {post.data.tags && post.data.tags.map((tag) => (
                <span>
                  <a class="tag" href={`/tags/${kebabCase(tag)}/`}>
                    # {tag}
                  </a>
                </span>
              ))}
            </div>
          </div>
        </div>
      </div>
    </article>
  </div>
</BaseLayout>

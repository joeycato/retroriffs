---
import { getCollection } from 'astro:content'
import type { CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'
import BaseLayout from '../layouts/BaseLayout.astro'

const posts = (await getCollection('blog')) as CollectionEntry<'blog'>[]

// Sort posts by date descending
const sortedPosts = [...posts].sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
)

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: '2-digit',
  })
}
---

<BaseLayout>
  <div id="main-content" class="content-box clearfix">
    {
      sortedPosts.map((post) => (
        <article class="post">
          {post.data.img && (
            <a href={`/stuff/${post.id}/`} class="post-thumbnail">
              <Image
                src={post.data.img}
                alt=""
                class="page-image"
                widths={[400, 800]}
                sizes="(max-width: 768px) 100vw, 30vw"
              />
            </a>
          )}
          <div class="post-content">
            <h2 class="post-title">
              <a href={`/stuff/${post.id}/`}>{post.data.title}</a>
            </h2>
            {post.data.excerpt && <p>{post.data.excerpt}</p>}
            <span class="post-date">{formatDate(post.data.date)}</span>
          </div>
        </article>
      ))
    }
  </div>
</BaseLayout>
